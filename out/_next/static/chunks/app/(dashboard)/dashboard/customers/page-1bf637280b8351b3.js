(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[636],{58859:function(e,t,r){Promise.resolve().then(r.bind(r,71669))},71669:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return CustomersPage}});var s=r(57437),n=r(2265),a=r(24866),c=r(70388),o=r(11039),l=r(23611),i=r(66005),u=r(70708),d=r(57918);function CustomersPage(){let[e,t]=(0,n.useState)([]),[r,f]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{let fetchCustomers=async()=>{try{let e=await (0,o.OL)();t(e)}catch(e){console.error("Error fetching customers:",e)}finally{f(!1)}};fetchCustomers()},[]),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)(a.x,{}),(0,s.jsx)(c.r,{children:(0,s.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("h2",{className:"text-2xl font-medium",children:"Customers"}),(0,s.jsx)("p",{className:"text-[hsl(var(--md-secondary))]",children:"Manage your customer relationships"})]}),(0,s.jsx)(l.z,{children:"Add Customer"})]}),(0,s.jsx)("div",{className:"rounded-lg border",children:(0,s.jsxs)(i.iA,{children:[(0,s.jsx)(i.xD,{children:(0,s.jsxs)(i.SC,{children:[(0,s.jsx)(i.ss,{children:"Name"}),(0,s.jsx)(i.ss,{children:"Email"}),(0,s.jsx)(i.ss,{children:"Status"}),(0,s.jsx)(i.ss,{children:"Joined"}),(0,s.jsx)(i.ss,{className:"text-right",children:"Action"})]})}),(0,s.jsx)(i.RM,{children:r?(0,s.jsx)(i.SC,{children:(0,s.jsx)(i.pj,{colSpan:5,className:"text-center",children:"Loading customers..."})}):0===e.length?(0,s.jsx)(i.SC,{children:(0,s.jsx)(i.pj,{colSpan:5,className:"text-center",children:"No customers found"})}):e.map(e=>(0,s.jsxs)(i.SC,{children:[(0,s.jsxs)(i.pj,{className:"font-medium",children:[e.first_name," ",e.last_name]}),(0,s.jsx)(i.pj,{children:e.email}),(0,s.jsx)(i.pj,{children:(0,s.jsx)(u.C,{variant:e.subscriptions.some(e=>"active"===e.status)?"default":"secondary",children:e.subscriptions.some(e=>"active"===e.status)?"Active":"Inactive"})}),(0,s.jsx)(i.pj,{children:(0,d.ZP)(new Date(e.created_at),"MMM d, yyyy")}),(0,s.jsx)(i.pj,{className:"text-right",children:(0,s.jsx)(l.z,{variant:"ghost",size:"sm",children:"View"})})]},e.id))})]})})]})})]})}},66005:function(e,t,r){"use strict";r.d(t,{RM:function(){return l},SC:function(){return u},iA:function(){return c},pj:function(){return f},ss:function(){return d},xD:function(){return o}});var s=r(57437),n=r(2265),a=r(81628);let c=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("div",{className:"relative w-full overflow-auto",children:(0,s.jsx)("table",{ref:t,className:(0,a.cn)("w-full caption-bottom text-sm",r),...n})})});c.displayName="Table";let o=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("thead",{ref:t,className:(0,a.cn)("[&_tr]:border-b",r),...n})});o.displayName="TableHeader";let l=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("tbody",{ref:t,className:(0,a.cn)("[&_tr:last-child]:border-0",r),...n})});l.displayName="TableBody";let i=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("tfoot",{ref:t,className:(0,a.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",r),...n})});i.displayName="TableFooter";let u=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("tr",{ref:t,className:(0,a.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",r),...n})});u.displayName="TableRow";let d=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("th",{ref:t,className:(0,a.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",r),...n})});d.displayName="TableHead";let f=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("td",{ref:t,className:(0,a.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",r),...n})});f.displayName="TableCell";let m=n.forwardRef((e,t)=>{let{className:r,...n}=e;return(0,s.jsx)("caption",{ref:t,className:(0,a.cn)("mt-4 text-sm text-muted-foreground",r),...n})});m.displayName="TableCaption"},11039:function(e,t,r){"use strict";r.d(t,{HT:function(){return getRecentSales},IN:function(){return getActiveSubscriptions},OL:function(){return getCustomers},Xp:function(){return getProducts},cO:function(){return getActiveUsers},lp:function(){return getRevenue},og:function(){return getMonthlyRevenue},yp:function(){return getTotalSales}});var s=r(12899);let getCustomers=async()=>{try{let{data:e,error:t}=await s.O.from("customers").select("*, subscriptions(*)").order("created_at",{ascending:!1});if(t)throw t;return e}catch(e){return console.error("Error fetching customers:",e),[]}},getProducts=async()=>{try{let{data:e,error:t}=await s.O.from("products").select("*").order("created_at",{ascending:!1});if(t)throw t;return e}catch(e){return console.error("Error fetching products:",e),[]}},getRevenue=async()=>{try{let{data:e,error:t}=await s.O.from("payments").select("amount").gte("created_at",new Date(new Date().setMonth(new Date().getMonth()-1)).toISOString());if(t)throw t;return e.reduce((e,t)=>e+t.amount,0)}catch(e){return console.error("Error fetching revenue:",e),0}},getMonthlyRevenue=async()=>{try{let{data:e,error:t}=await s.O.from("payments").select("amount, created_at").gte("created_at",new Date(new Date().setFullYear(new Date().getFullYear()-1)).toISOString());if(t)throw t;let r=Array(12).fill(0);return e.forEach(e=>{let t=new Date(e.created_at);r[t.getMonth()]+=e.amount}),["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].map((e,t)=>({name:e,total:r[t]}))}catch(e){return console.error("Error fetching monthly revenue:",e),[]}},getActiveSubscriptions=async()=>{try{let{data:e,error:t}=await s.O.from("subscriptions").select("*").eq("status","active");if(t)throw t;return e.length}catch(e){return console.error("Error fetching active subscriptions:",e),0}},getTotalSales=async()=>{try{let{count:e,error:t}=await s.O.from("payments").select("*",{count:"exact"});if(t)throw t;return e||0}catch(e){return console.error("Error fetching total sales:",e),0}},getActiveUsers=async()=>{try{let{count:e,error:t}=await s.O.from("usage_logs").select("*",{count:"exact"}).gte("created_at",new Date(new Date().setHours(new Date().getHours()-1)).toISOString());if(t)throw t;return e||0}catch(e){return console.error("Error fetching active users:",e),0}},getRecentSales=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;try{let{data:t,error:r}=await s.O.from("payments").select("\n        *,\n        customers (\n          first_name,\n          last_name,\n          email\n        )\n      ").order("created_at",{ascending:!1}).limit(e);if(r)throw r;return t}catch(e){return console.error("Error fetching recent sales:",e),[]}}}},function(e){e.O(0,[579,700,390,600,918,315,971,472,744],function(){return e(e.s=58859)}),_N_E=e.O()}]);